---
layout: post
title: "学术报告"
subtitle: 'LLM 驱动的自动化渗透测试前沿：PentestGPT、PenHeal 与 PentestAgent' 
date: 2025.12 
host: "戴静桐" 
digest: "本次组会聚焦于利用大语言模型（LLM）革新渗透测试流程，深入解读了三个具有代表性的自动化框架。PentestGPT 通过任务树解决上下文丢失问题；PenHeal 实现了从攻击到最优修复的闭环；PentestAgent 则利用多智能体协作与 RAG 技术实现了更高效的端到端自动化。报告对比了各框架的架构优势与实验性能，并展望了未来微观任务优化与多智能体协同的发展方向。"
permalink: /:categories/:year/:month/:day/:title
categories:
- seminar
---

## LLM 赋能网络安全：自动化渗透测试的演进之路

## 1. 任务简介

本次汇报的主题是“大语言模型（LLM）渗透测试”。该任务旨在利用 LLM 强大的代码理解与命令生成能力，自动化执行网络安全评估中的渗透测试工作 。 工作涵盖了从利用 LLM 辅助人工测试，到构建全自动智能体进行漏洞发现、利用及修复建议生成的完整技术演进路线。

## 2. 研究动机

传统渗透测试高度依赖人工操作和专业知识，难以满足高效安全评估的需求 。虽然 GPT-4 等模型在阅读源码和生成命令上表现出色，但在实际渗透测试中面临三大核心挑战：
1.  **上下文丢失**：随着对话轮次增加，关键的早期信息容易被模型遗忘 。
2.  **命令幻觉**：模型倾向于生成不存在的工具参数或错误的命令，导致执行失败 。
3.  **知识局限性**：模型无法覆盖最新的漏洞信息，且难以掌握特定工具的复杂用法 。 此外，现有的自动化尝试往往止步于漏洞扫描，缺乏对后续修复环节的自动化决策支持 。

## 3. 方法设计

本次报告详细介绍了三种针对上述痛点提出的解决方案：

**1）PentestGPT：解决上下文记忆的交互式系统**

- **核心创新**：引入了 **Pentesting Task Tree (PTT)**，一种树形结构来维护测试上下文，有效克服记忆丢失和注意力分散问题 。
- **模块架构**：
  - **推理模块 (Reasoning)**：负责任务树的生成、验证、更新及优先级排序，模拟人类专家的决策过程 。
  - **生成模块 (Generation)**：利用思维链 (CoT) 将子任务转化为具体的终端命令 。
  - **解析模块 (Parsing)**：对 Nmap 等工具的冗长输出进行摘要压缩，提取关键信息供 LLM 理解 。

**2）PenHeal：渗透与修复的自动化闭环**
- **核心理念**：不仅关注攻击，还关注修复，并在预算约束下提供最优修复策略 。
- **两阶段设计**：
  - **渗透模块**：引入“反事实提示” (Counterfactual Prompt) 驱动 Planner 更新攻击路径，当一个漏洞被利用后，假装其不存在以探索新路径 。
  - **修复模块**：结合 CVSS 评分与用户预算，利用分组背包算法计算性价比最高的修复方案组合 。

**3）PentestAgent：多智能体协作与 RAG 增强**

- **架构升级**：在 PentestGPT 基础上减少人工干预，设计了四个专用智能体协作：侦察、搜索、规划、执行 。
- **技术亮点**：

  - **RAG (检索增强生成)**：实时从外部知识库检索漏洞报告 (CVE) 和工具用法，显著减少幻觉 。
  - **过程级知识库**：搜索代理建立分层的攻击知识库，涵盖从粗粒度攻击面到具体利用步骤的信息 。

## 4. 实施细节

**系统实现：**

- **PentestGPT**：包含 1900 行 Python 代码，支持与 GPT-3.5 和 GPT-4 集成，通过自然语言与用户交互 。
- **PenHeal**：利用 LangChain-RAG 实现 Instructor，Planner/Executor 使用 GPT-4，而摘要与提取使用 GPT-3.5 以平衡成本 。
- **PentestAgent**：构建了特定的 Recon Loop（侦察循环）和 Exploit Loop（利用循环），并引入自我反思机制记录错误历史以避免重复错误 。

**基准测试构建：**

- **PentestPerf**：PentestGPT 作者构建的基准，包含 13 台靶机和 182 个子任务，涵盖 OWASP Top 10 漏洞 。
- **VulHub 数据集**：PentestAgent 选择了 67 个目标，涵盖 32 种 CWE 类别，分为简单、中等和困难三个等级 。

## 5. 实验与结论
1）PentestGPT 表现

- 在基准测试中，PentestGPT-GPT-4 相比原生 GPT-4 完成了更多子任务（57 vs 27），增幅达 111%。
- 策略上，它能像人类专家一样在 FTP 和 Web 服务间建立联系，成功切换攻击路径。
- 实战中，在 HackTheBox 平台上以 131.5 美元成本完成了 50% 的选定目标。

2）PenHeal 表现

- **检测覆盖率**：得分 5.67，比 GPT-4 高 31%。
- **修复有效性**：得分 7.6，比 PentestGPT 高 32%。
- **综合得分**：9.87，显著优于对比基线，且修复建议成本比 GPT-4 低 46%。

3）PentestAgent 表现

- **成功率**：在 VulHub 基准上，GPT-4 驱动的 PentestAgent 总体成功率达 74.2%。
- **效率对比**：在 HackTheBox 测试中，情报收集仅耗时 220秒（PentestGPT 需 1199秒），漏洞利用耗时 172秒（PentestGPT 需 364秒），证明了全自动化流程的高效性。

**未来展望：** 未来的研究将聚焦于优化上下文结构以处理非线性攻击路径 ，利用 LLM 优化指纹识别等微观任务 ，以及设计模拟人类红队的多智能体协同架构 。
[本次组会内容下载链接](https://github.com/Evangeline-J/files/blob/main/1223.pdf)